import os
import datetime
import pytz
import asyncio
from telegram import Bot

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")
TIMEZONE_STR = os.getenv("TIMEZONE", "Europe/Kyiv")

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥—Ä—É–ø–ø –∏ –∏—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
# –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –¥–Ω–µ–π: "0": –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, "1": –í—Ç–æ—Ä–Ω–∏–∫, ... "6": –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
GROUPS_DATA = [
    {
        "group": "–ë–∞—Ä–∞–∫—É–¥–∞",
        "address": "–≤—É–ª. –õ–∞—Ä–∏—Å–∏ –†—É–¥–µ–Ω–∫–æ, 3 (–∫–∞–±. 008)",
        "schedule": {"0": "16:00-17:15", "2": "20:00-21:00"}
    },
    {
        "group": "–ù–∞ –ü–æ–∑–Ω—è–∫–∞—Ö",
        "address": "–•–∞—Ä–∫—ñ–≤—Å—å–∫–µ —à–æ—Å–µ 57, 2 –ø–æ–≤–µ—Ä—Ö",
        "schedule": {
            "0": "19:00-20:15", "1": "19:00-20:15", "2": "19:00-20:15",
            "3": "19:00-20:15", "4": "19:00-20:15", "5": "19:00-20:15", "6": "19:00-20:15"
        }
    },
    {
        "group": "–í—ñ–Ω—Ç–∞–∂",
        "address": "–Ü–≤–∞–Ω–∞ –ú–∏–∫–æ–ª–∞–π—á—É–∫–∞, 11 (2 –ø–æ–≤–µ—Ä—Ö)",
        "schedule": {"4": "19:00", "5": "19:00", "6": "19:00"}
    },
    {
        "group": "–í–∏—à–Ω—è",
        "address": "–º. –í–∏—à–Ω–µ–≤–µ, –≤—É–ª. –°–≤—è—Ç–æ—à–∏–Ω—Å—å–∫–∞ 42 (–ö–æ–ª–æ —Å–∏–ª–∏)",
        "schedule": {"0": "18:00-19:00"}
    },
    {
        "group": "–¢i–ª—å–∫–∏ –°—å–æ–≥–æ–¥–Ωi (Online)",
        "address": "https://t.me/%2BrAqy7n9GjfQ3MjYy",
        "schedule": {
            "0": "08:00, 17:00, 21:00, 01:00",
            "1": "08:00, 17:00, 21:00",
            "2": "08:00, 17:00, 21:00",
            "3": "08:00, 17:00, 21:00",
            "4": "08:00, 17:00, 21:00",
            "5": "08:00, 17:00, 21:00",
            "6": "08:00, 17:00, 21:00, 01:00"
        }
    },
    {
        "group": "–ù–∞ —á–∞—Å—ñ",
        "address": "–≤—É–ª. –ú–µ–∂–∏–≥—ñ—Ä—Å—å–∫–∞ 22, –ø—ñ–¥‚Äô—ó–∑–¥ 5",
        "schedule": {
            "0": "13:00-14:00", "1": "13:00-14:00", "2": "13:00-14:00",
            "3": "13:00-14:00", "4": "13:00-14:00", "5": "13:00-14:00", "6": "13:00-14:00"
        }
    },
    {
        "group": "–úayday",
        "address": "–≤—É–ª. –ö—Ä—É–≥–ª–æ—É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å—å–∫–∞, 7",
        "schedule": {
            "0": "19:00-20:15", "1": "19:00-20:15", "2": "19:00-20:15",
            "3": "19:00-20:15", "4": "19:00-20:15", "5": "19:00-20:15", "6": "19:00-20:15"
        }
    },
    {
        "group": "–úayday online",
        "address": "https://t.me/maydayonline",
        "schedule": {
            "0": "08:00, 12:00, 21:00, 23:00",
            "1": "08:00, 12:00, 21:00", "2": "08:00, 12:00, 21:00",
            "3": "08:00, 12:00, 21:00", "4": "08:00, 12:00, 21:00",
            "5": "08:00, 12:00, 21:00, 23:00", "6": "08:00, 12:00, 21:00, 23:00"
        }
    },
    {
        "group": "NA –¢—Ä–æ—î—â–∏–Ω—ñ",
        "address": "–≤—É–ª. –°–µ—Ä–∂–∞ –õ–∏—Ñ–∞—Ä—è 20, –ñ–ï–ö 313",
        "schedule": {
            "0": "19:00", "1": "19:00", "2": "19:00",
            "3": "19:00", "4": "19:00-20:00", "5": "19:00", "6": "19:00"
        }
    },
    {
        "group": "–ü–∞—Ä—É—Å",
        "address": "–≤—É–ª. –î–æ–≤–∂–µ–Ω–∫–∞, 2. (–ú. –®—É–ª—è–≤—Å—å–∫–∞)",
        "schedule": {
            "0": "19:00-20:30", "1": "19:00-20:30", "2": "19:00-20:30",
            "4": "19:00-20:30", "5": "19:00-20:30", "6": "19:00-20:30"
        }
    },
    {
        "group": "–°—Ç–∞–ª—å",
        "address": "–≤—É–ª. –ú–∞—Ä–∏—á–∞–Ω—Å—å–∫–∞ 5",
        "schedule": {"2": "19:00", "4": "19:00", "6": "17:00"}
    },
    {
        "group": "–ë—É—á-–ê–ù-–∫–∞",
        "address": "–º. –ë—É—á–∞. –≤—É–ª. –ñ–æ–≤—Ç–Ω–µ–≤–∞ 66, –∫—ñ–º. 136–ê",
        "schedule": {"1": "19:30-20:30", "3": "19:30-20:30", "5": "19:30-20:30"}
    },
    {
        "group": "–ù–∞–º –Ω–µ –≤—Å–µ –æ–¥–Ω–æ",
        "address": "–ø—Ä. –ì–æ–Ω–≥–∞–¥–∑–µ 20",
        "schedule": {
            "0": "19:00-20:00", "1": "19:00-20:00", "2": "19:00-20:00",
            "3": "19:00-20:00", "4": "19:00-20:00", "5": "19:00-20:00", "6": "19:00-20:00"
        }
    },
    {
        "group": "–í–æ—Å–∫—Ä—î—Å—î–Ω–∫–∞",
        "address": "–≤—É–ª. –ú–∏–∫—ñ–ª—å—Å—å–∫–æ-–°–ª–æ–±—ñ–¥—Å—å–∫–∞, 5",
        "schedule": {"3": "17:30", "5": "17:30"}
    },
    {
        "group": "–°–æ–ª–æ–º'—è–Ω–∫–∞",
        "address": "–≤—É–ª. –ú–∞–∫—Å–∏–º–∞ –ö—Ä–∏–≤–æ–Ω–æ—Å–∞ 21",
        "schedule": {"0": "17:00-18:00", "1": "19:00-20:00", "3": "19:00-20:00", "5": "19:00-20:00"}
    },
    {
        "group": "–í –ë—Ä–æ–≤–∞—Ä–∞—Ö",
        "address": "–º. –ë—Ä–æ–≤–∞—Ä–∏, –≤—É–ª. –ì–µ—Ä–æ—ó–≤ –£–∫—Ä–∞—ó–Ω–∏ 26, –∫–∞–±. 401",
        "schedule": {
            "0": "13:00-14:00", "1": "19:00-20:00", "2": "19:00-20:00",
            "3": "19:00-20:00", "4": "19:00-20:00", "5": "19:00-20:00", "6": "13:00-14:00"
        }
    },
    {
        "group": "–ë–æ—è—Ä–∫–∞",
        "address": "–º.–ë–æ—è—Ä–∫–∞, –≤—É–ª. –Ø—Ä–æ—Å–ª–∞–≤–∞ –ú—É–¥—Ä–æ–≥–æ, 62",
        "schedule": {"6": "16:00"}
    },
    {
        "group": "–í–∏—à–≥–æ—Ä–æ–¥",
        "address": "–º.–í–∏—à–≥–æ—Ä–æ–¥, –ø—Ä–æ—Å–ø–µ–∫—Ç –®–µ–≤—á–µ–Ω–∫–∞ 6",
        "schedule": {"1": "19:00"}
    },
    {
        "group": "–í–£–ê–ù (–í–µ—Ç–µ—Ä–∞–Ω–∏)",
        "address": "–≤—É–ª. –†–æ–≥–Ω—ñ–¥–∏–Ω—Å—å–∫–∞, 3, –∫—ñ–º. 4",
        "schedule": {"6": "13:00-14:00"}
    }
]

def format_schedule(weekday_idx):
    """–§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ –≥—Ä—É–ø–ø–∞—Ö"""
    days_names = ["–ü–û–ù–ï–î–Ü–õ–û–ö", "–í–Ü–í–¢–û–†–û–ö", "–°–ï–†–ï–î–ê", "–ß–ï–¢–í–ï–†", "–ü‚Äô–Ø–¢–ù–ò–¶–Ø", "–°–£–ë–û–¢–ê", "–ù–ï–î–Ü–õ–Ø"]
    day_str = str(weekday_idx)
    
    header = f"üìÖ *–†–û–ó–ö–õ–ê–î –ù–ê {days_names[weekday_idx]}*\n\n"
    body = ""
    
    for item in GROUPS_DATA:
        time = item["schedule"].get(day_str)
        if time:  # –ï—Å–ª–∏ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å –µ—Å—Ç—å –∑–∞–Ω—è—Ç–∏–µ
            body += f"üîπ *{item['group']}*\n"
            body += f"‚è∞ {time}\n"
            body += f"üìç {item['address']}\n\n"
            
    if not body:
        return header + "–°—å–æ–≥–æ–¥–Ω—ñ –∑–∞—Ö–æ–¥—ñ–≤ –Ω–µ–º–∞—î."
        
    return header + body

async def main():
    if not TOKEN or not CHAT_ID:
        print("–û—à–∏–±–∫–∞: –¢–æ–∫–µ–Ω –∏–ª–∏ ID —á–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!")
        return

    bot = Bot(token=TOKEN)
    tz = pytz.timezone(TIMEZONE_STR)
    now = datetime.datetime.now(tz)
    
    weekday_idx = now.weekday()
    message = format_schedule(weekday_idx)
    
    print(f"–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ –¥–µ–Ω—å {weekday_idx}...")
    try:
        await bot.send_message(chat_id=CHAT_ID, text=message, parse_mode="Markdown")
        print("–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: {e}")

if __name__ == "__main__":
    asyncio.run(main())
